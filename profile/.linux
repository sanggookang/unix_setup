# Ctrl-U to backward kill line
bindkey "^u" backward-kill-line

docker_clean() {
  local name=$(basename "$PWD")
  local dangling_images=("${(@f)$(sudo docker images -f "dangling=true" -q)}")
  if [[ ! -z $(sudo docker ps -a | grep $name) ]]; then
    echo removing outdated container
    sudo docker rm $name
  fi
	if [[ ! -z $dangling_images ]]; then
		echo removing outdated images
    for image in $dangling_images
    do
      echo removing image: $image
      sudo docker rmi $image
    done
	fi
}

# Build Docker from folder
docker_build() {
  docker_clean
	sudo docker build --rm -t $(basename "$PWD"):latest . 
}

# Run Docker from folder
docker_run() {
  docker_clean
	sudo docker run --gpus all --name $(basename "$PWD") $(basename "$PWD"):latest
}
